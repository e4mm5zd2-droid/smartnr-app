# データエクスポート機能ガイド

## 実装済み機能 ✅

### 1. エクスポート形式
- **Excel (.xlsx)**: 最も一般的な表計算形式
- **CSV (.csv)**: シンプルなテキスト形式
- **JSON (.json)**: バックアップ・開発用

### 2. エクスポート対象
- **キャスト一覧**: 全キャスト情報
- **給料データ**: 給料申請履歴
- **面接予定**: スケジュール一覧

### 3. データフォーマット
- **日本語ヘッダー**: 読みやすい列名
- **日本円表記**: ¥記号付き金額
- **日付フォーマット**: 日本形式（YYYY/MM/DD）
- **ステータス翻訳**: 英語→日本語

---

## 使用方法

### キャスト一覧のエクスポート
1. **キャスト一覧ページ**に移動
2. 検索・フィルターで絞り込み（任意）
3. **「エクスポート」ボタン**をクリック
4. 形式を選択（Excel/CSV/JSON）
5. ファイルが自動ダウンロード

### エクスポートされるデータ
```
ID | 名前 | 年齢 | 身長 | 体型 | 髪型 | 雰囲気タグ | 希望エリア | 希望時給 | 経験 | 登録日
```

**例:**
```
1 | あやか | 23 | 165cm | スレンダー | ロング | 清楚系, 癒し系 | 祇園 | ¥3,500 | 経験あり | 2026/01/15
```

---

## エクスポート形式の比較

### Excel (.xlsx)
**推奨用途:** 通常使用・共有・分析

**メリット:**
- ✅ 複数シート対応
- ✅ 書式設定可能
- ✅ フィルター・ソート機能
- ✅ グラフ作成可能
- ✅ 一般的で開きやすい

**デメリット:**
- ❌ ファイルサイズが大きい

### CSV (.csv)
**推奨用途:** システム連携・軽量データ

**メリット:**
- ✅ ファイルサイズが小さい
- ✅ テキストエディタで開ける
- ✅ 他システムとの連携が容易
- ✅ Google Sheets等で開ける

**デメリット:**
- ❌ 1シートのみ
- ❌ 書式設定なし

### JSON (.json)
**推奨用途:** バックアップ・開発・API連携

**メリット:**
- ✅ 構造化データ
- ✅ プログラムで処理しやすい
- ✅ 完全なデータ保持
- ✅ 入れ子構造対応

**デメリット:**
- ❌ 一般ユーザーには読みにくい

---

## データ項目詳細

### キャストデータ
| 項目 | 説明 | 例 |
|------|------|-----|
| ID | キャストID | uuid |
| 名前 | 源氏名 | あやか |
| 年齢 | 年齢 | 23 |
| 身長 | 身長（cm） | 165cm |
| 体型 | 体型タイプ | スレンダー |
| 髪型 | 髪型 | ロング |
| 雰囲気タグ | 雰囲気・特徴 | 清楚系, 癒し系 |
| 希望エリア | 勤務希望エリア | 祇園 |
| 希望時給 | 希望する時給 | ¥3,500 |
| 経験 | 業界経験 | 経験あり |
| 登録日 | 登録日 | 2026/01/15 |

### 給料データ
| 項目 | 説明 | 例 |
|------|------|-----|
| ID | 申請ID | uuid |
| スカウト名 | 申請者名 | 京極 蓮 |
| キャスト名 | 対象キャスト | あやか |
| 店舗名 | 勤務店舗 | Club LION |
| 勤務期間 | 期間 | 2026年1月 |
| 基本報酬 | 基本額 | ¥50,000 |
| ボーナス | ボーナス | ¥10,000 |
| 合計金額 | 総額 | ¥60,000 |
| ステータス | 承認状況 | 承認済み |
| 申請日 | 申請日 | 2026/01/31 |

### 面接データ
| 項目 | 説明 | 例 |
|------|------|-----|
| ID | 面接ID | uuid |
| キャスト名 | 対象者 | あやか |
| 面接日時 | 日時 | 2026/02/15 15:00 |
| 場所 | 面接場所 | Club LION（祇園） |
| ステータス | 状況 | 予定 |
| メモ | 備考 | 経験者 |
| 登録日 | 登録日 | 2026/02/12 |

---

## 高度な機能

### 月次レポートエクスポート（今後実装）
```typescript
// 複数シートを含むExcelを生成
exportMonthlyReport({
  casts: [...],
  salaries: [...],
  interviews: [...]
}, '2026-01');
```

**生成されるExcel:**
- シート1: キャスト一覧
- シート2: 給料申請
- シート3: 面接予定

### フィルター適用エクスポート
検索・フィルターで絞り込んだデータのみエクスポート可能

**例:**
1. 検索: "祇園"
2. フィルター: ステータス = 活動中
3. エクスポート → 条件に合うデータのみ出力

### カスタムフォーマット（今後実装）
```typescript
// ユーザー独自のフォーマット設定
const customFormat = {
  columns: ['name', 'age', 'phone'],
  headers: ['名前', '年齢', '連絡先'],
  sortBy: 'age',
  order: 'desc'
};
```

---

## セキュリティ

### データ保護
- **ブラウザ内処理**: データはサーバーに送信されない
- **クライアントサイド生成**: ファイルはローカルで生成
- **ダウンロード後削除**: メモリから即座に削除

### 個人情報の取り扱い
- エクスポートしたファイルは厳重に管理
- 不要になったら速やかに削除
- 第三者への共有は慎重に

### 推奨設定
- **パスワード保護**: Excelファイルにパスワード設定（手動）
- **暗号化ストレージ**: 保存先を暗号化
- **アクセス制限**: 必要最小限の人のみアクセス

---

## トラブルシューティング

### ファイルがダウンロードされない
1. **ブラウザのポップアップブロック**を確認
2. **ダウンロード設定**を確認
3. **ストレージ容量**を確認

### 文字化けする
**CSVファイルをExcelで開く場合:**
1. Excelを起動
2. 「データ」タブ > 「テキストファイルから」を選択
3. エンコーディングを **UTF-8** に設定
4. 区切り文字を **カンマ** に設定

### ファイルが開けない
- **Excel**: Microsoft Excel 2007以降が必要
- **CSV**: テキストエディタまたはGoogle Sheetsで開く
- **JSON**: テキストエディタまたはJSON Viewerで開く

---

## API仕様（今後実装）

### GET /api/export/casts
キャストデータをエクスポート

**クエリパラメータ:**
- `format`: csv | xlsx | json
- `filter`: フィルター条件（JSON）

**レスポンス:**
ファイルダウンロード

### POST /api/export/monthly-report
月次レポートを生成

**リクエスト:**
```json
{
  "month": "2026-01",
  "types": ["casts", "salaries", "interviews"]
}
```

**レスポンス:**
Excelファイル（複数シート）

---

## ベストプラクティス

### 定期的なエクスポート
- **月1回**: 月初に前月分をエクスポート
- **バックアップ**: クラウドストレージに保存
- **履歴管理**: 過去データと比較

### ファイル命名規則
```
キャスト一覧_20260131.xlsx
給料データ_202601.xlsx
月次レポート_2026-01_full.xlsx
```

### データ分析活用
1. Excelでエクスポート
2. ピボットテーブルで集計
3. グラフで可視化
4. レポート作成

---

## 今後の拡張予定

- [ ] PDF形式エクスポート
- [ ] 画像付きエクスポート（キャスト写真）
- [ ] 自動定期エクスポート
- [ ] クラウドストレージ直接保存
- [ ] テンプレート機能
- [ ] メール添付送信
- [ ] カスタムフォーマット設定
- [ ] 差分エクスポート（前回との変更点のみ）
- [ ] QRコード生成（キャスト情報）
- [ ] 印刷最適化フォーマット
